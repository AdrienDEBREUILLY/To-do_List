<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Inclusion de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com" rel="stylesheet"></script>
    <title>To-do_List</title>
</head>
<body class="h-screen flex-row justify-center item-center">
    <div class="container mx-auto mt-5">
        <h1 class="text-4xl text-center mb-5">To-do List</h1>
        <!-- Formulaire pour ajouter une nouvelle tâche -->
        <form class="mb-5">
            <div class="flex">
                <label for="new-task" class="sr-only">Ajouter une nouvelle tâche</label>
                <!-- Champ de saisie pour ajouter une nouvelle tâche -->
                <input type="text" id="new-task" placeholder="Add a new task..." class="flex-1 py-2 px-3 border border-gray-300 rounded mr-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <!-- Bouton pour ajouter une nouvelle tâche -->
                <button type="submit" class="bg-blue-500 text-white py-2 px-3 rounded hover:bg-blue-600">Add</button>
            </div>
        </form>
        <!-- Liste des tâches à faire -->
        <ul id="task-list" class="list-none">
            <!-- Les tâches seront ajoutées ici -->
        </ul>
        <!-- Liste des tâches terminées -->
        <ul id="completed-task-list" class="list-none mt-5">
            <!-- Les tâches terminées seront ajoutées ici -->
        </ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Sélection des éléments du DOM nécessaires
            const taskList = document.getElementById('task-list');
            const newTaskInput = document.getElementById('new-task');
            const completedTaskList = document.getElementById('completed-task-list');

            // Fonction pour définir la couleur de fond en fonction de la priorité
            const setBackgroundColor = (task) => {
                const priority = task.querySelector('select').value;
                switch (priority) {
                    case 'low':
                        task.style.backgroundColor = '#f5f5f5';
                        break;
                    case 'medium':
                        task.style.backgroundColor = '#ffffe6';
                        break;
                    case 'high':
                        task.style.backgroundColor = '#ffebd2';
                        break;
                    default:
                        task.style.backgroundColor = '#ffffff';
                }
            };
            
            // Fonction pour trier les tâches en fonction de leur priorité
            const sortTasks = () => {
                Array.from(taskList.children) // Convertir les éléments enfants en tableau
                    .sort((a, b) => {
                        const priorityOrder = { 'low': 3, 'medium': 2, 'high': 1 };
                        const aPriority = priorityOrder[a.querySelector('select').value];
                        const bPriority = priorityOrder[b.querySelector('select').value];
                        return aPriority - bPriority;
                    })
                    .forEach((task) => {
                        taskList.appendChild(task); // Réinsérer chaque tâche dans la liste triée
                    });
            };
            
            // Ajouter une nouvelle tâche
            document.querySelector('form').addEventListener('submit', (e) => {
                e.preventDefault();
                if (!newTaskInput.value.trim()) return;

                // Création de l'élément de tâche
                const task = document.createElement('li');
                task.className = 'bg-white p-3 my-2 rounded shadow-md flex justify-between items-center';

                // Création des éléments de la tâche (texte, boutons, etc.)
                const taskContent = document.createElement('div');
                taskContent.className = 'flex-1';

                const taskCheckbox = document.createElement('input');
                taskCheckbox.type = 'checkbox';
                taskCheckbox.className = 'w-4 h-4 border border-gray-400 rounded cursor-pointer flex-shrink-0 mr-2';

                const taskText = document.createElement('span');
                taskText.textContent = newTaskInput.value.trim();
                taskText.className = 'flex-1';
                
                const taskNotesButton = document.createElement('button');
                taskNotesButton.className = 'bg-yellow-500 text-white py-1 px-2 rounded mr-2 hover:bg-yellow-600';
                taskNotesButton.textContent = 'Notes';
                
                const taskNotes = document.createElement('textarea');
                taskNotes.style.display = 'none';
                taskNotes.placeholder = 'Add notes...';
                
                const taskButtons = document.createElement('div');
                taskButtons.className = 'flex';

                const taskDeadlineInput = document.createElement('input');
                taskDeadlineInput.type = 'date';
                taskDeadlineInput.className = 'py-1 px-2 border border-gray-300 rounded mr-2';

                const taskPriority = document.createElement('select');
                taskPriority.className = 'text-black py-1 px-2 rounded mr-2';
                taskPriority.innerHTML = `
                    <option value="default">default</option>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                `;

                const taskEditButton = document.createElement('button');
                taskEditButton.dataset.id = task.dataset.id
                taskEditButton.className = 'bg-blue-500 text-white py-1 px-2 rounded mr-2 hover:bg-blue-600';
                taskEditButton.textContent = 'Edit';

                const taskDelete = document.createElement('button');
                taskDelete.className = 'bg-red-500 text-white py-1 px-2 rounded hover:bg-red-600';
                taskDelete.textContent = 'Delete';

                // Ajout des éléments à la tâche
                task.appendChild(taskCheckbox);
                task.appendChild(taskText);
                task.appendChild(taskNotesButton);
                task.appendChild(taskNotes);
                task.appendChild(taskButtons);
                taskButtons.appendChild(taskPriority);
                taskButtons.appendChild(taskDeadlineInput);
                taskButtons.appendChild(taskEditButton);
                taskButtons.appendChild(taskDelete);
                taskList.appendChild(task);
                
                // Définir la couleur de fond en fonction de la priorité
                setBackgroundColor(task)
                
                // Ajout d'un événement pour changer la priorité
                taskPriority.addEventListener('change', () => {
                    setBackgroundColor(task);
                    sortTasks();
                });
                
                taskCheckbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        e.target.disabled = true; // Désactiver la case à cocher une fois cochée
                    }
                });

                // Réinitialiser la valeur de l'entrée
                newTaskInput.value = '';

                // Focus sur l'entrée
                newTaskInput.focus();
                
                // Ajouter un écouteur d'événement pour le bouton "Ajouter"
                document.querySelector('button[type="submit"]').addEventListener('click', () => {
                    sortTasks(); // Trier les tâches après l'ajout d'une nouvelle tâche
                });
                
            });

            // Toggle pour afficher/masquer les notes
            taskList.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && e.target.textContent === 'Notes') {
                    const task = e.target.closest('li');
                    const taskNotes = task.querySelector('textarea');
                    taskNotes.style.display = taskNotes.style.display === 'none' ? 'block' : 'none';
                }
            });
            
            // Validation d'une tâche
            taskList.addEventListener('change', (e) => {
                if (e.target.tagName === 'INPUT' && e.target.type === 'checkbox') {
                    const task = e.target.closest('li');
                    
                    if (e.target.checked) {
                        task.classList.toggle('line-through');
                        // Déplacer la tâche vers la liste des tâches terminées
                        completedTaskList.appendChild(task);
                    } else {
                        task.classList.remove('line-through');        
                        // Déplacer la tâche vers la liste des tâches à faire
                        taskList.appendChild(task);
                    }
                }
            });

            // Supprimer une tâche
            const deleteTask = (task) => {
                task.remove();
            };            
            
            // Supprimer une tâche de la liste des tâches terminées
            completedTaskList.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && e.target.textContent === 'Delete') {
                    const task = e.target.closest('li');
                    deleteTask(task);
                }
            });

            // Modifier une tâche
            taskList.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && e.target.textContent === 'Edit') {
                    const task = e.target.closest('li');
                    const taskText = task.querySelector('span');
                    const newTaskText = prompt('Enter the new task text:');
                    if (newTaskText) {
                        taskText.textContent = newTaskText;
                    }
                }
            });
        });
    </script>
</body>
</html>
